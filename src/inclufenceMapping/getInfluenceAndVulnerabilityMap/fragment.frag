precision mediump float;

uniform sampler2D uInfluenceSample2;
uniform sampler2D uTensionSample2;

varying vec2 vUvs;

void main() {
  vec4 myInfluence = texture2D(uInfluenceSample2, vUvs);
  vec4 tensionMap = texture2D(uTensionSample2, vUvs);
  float influenceMap = -(tensionMap.g - 2.0 * myInfluence.r);
  // TODO: use alpha chanel somehow, read why alpha != 1 sets red channel to 255
  gl_FragColor = vec4(
    myInfluence.r,
    sign(tensionMap.b - 0.5) * (tensionMap.g - myInfluence.r),
    // 0.33 is our
    // 0.66 is enemy
    // 0.99 is our and enemy

    (tensionMap.g - abs(influenceMap)), // vulnerability
    1.0 // do not modify alpha, alpha < 1.0 changes red of channel to 255 in extract.pixels method
  );
}
